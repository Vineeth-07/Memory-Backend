generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum AudioStatus {
  UPLOADED
  TRANSCRIBING
  TRANSCRIBED
  FAILED
}

enum JobType {
  AUDIO_UPLOAD
  TRANSCRIPTION
  POST_PROCESSING
}

enum ProcessingStatus {
  INITIALIZED
  PROCESSING
  PROCESSED
  FAILED
}

model User {
  id            String          @id @default(uuid())
  email         String          @unique
  password_hash String
  is_verified   Boolean
  status        UserStatus
  created_at    DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  sessions      Session[]
  audioRecords  Audio_Records[]
}

model Session {
  id                 String    @id @default(uuid())
  user_id            String
  user               User      @relation(fields: [user_id], references: [id])
  refresh_token_hash String
  user_agent         String
  ip_address         String
  created_at         DateTime  @default(now())
  expires_at         DateTime
  revoked_at         DateTime?

  @@unique([user_id, user_agent]) // FOR ONE SESSION PER DEVICE ACCESS
  @@index([user_id]) // INDEXING FOR FASTER READS
  @@index([refresh_token_hash]) // INDEXING FOR FASTER READS
}

model Audio_Records {
  id             String            @id @default(uuid())
  user_id        String
  user           User              @relation(fields: [user_id], references: [id])
  audio_url      String
  duration       Int
  language       String
  status         AudioStatus
  created_at     DateTime          @default(now())
  processingJobs Processing_Jobs[]
}

model Processing_Jobs {
  id              String           @id @default(uuid())
  audio_record_id String
  audio           Audio_Records    @relation(fields: [audio_record_id], references: [id])
  job_type        JobType
  status          ProcessingStatus
  attempts        Int
  error_message   String?
  created_at      DateTime         @default(now())
  started_at      DateTime?
  finished_at     DateTime?
}
